#!/usr/bin/env bash
#  Related variables
#  ┌───────────┬──────────────────────┐
#  │ Variable  │       Meaning        │
#  ├───────────┼──────────────────────┤
#  │ $@        │ All arguments        │
#  ├───────────┼──────────────────────┤
#  │ $#        │ Number of arguments  │
#  ├───────────┼──────────────────────┤
#  │ $0        │ Script name          │
#  ├───────────┼──────────────────────┤
#  │ $1, $2... │ Individual arguments │
#  └───────────┴──────────────────────┘

usage() {
  cat <<'EOF'
Run install scripts in install.d/ by name

Usage: install [--dry] [name...]
       install [--dry] --all

Options:
  --all   run every script in install.d/
  --dry   show what will be done
EOF
}

if [[ $# -eq 0 ]]; then
  usage
fi

all=""
dry=""
names=()

while [[ $# -gt 0 ]]; do
  if [[ "$1" == "--dry" ]]; then
    dry="1"
  elif [[ "$1" == "--all" ]]; then
    all="1"
  else
    names+=("$1")
  fi
  shift
done

scripts=`find install.d/ -type f -executable`

if [[ $dry == "1" ]]; then
  for s in $scripts; do
    echo "[DRY] will run ${s}"
  done
  exit 0
fi
